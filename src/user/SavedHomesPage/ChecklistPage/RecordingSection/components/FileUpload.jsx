import { useRef } from "react";
import { FileSelectButton, SelectedFileName, RemoveFileButton } from "../styles/RecordingStyles";

const FileUpload = ({ selectedFile, onFileSelect, onRemoveFile, isLoading }) => {
  const fileInputRef = useRef(null);
  // 파일 선택 핸들러
  const handleFileSelect = () => {
    if (fileInputRef.current) {
      fileInputRef.current.click();
    }
  };

  const handleFileChange = (event) => {
    const file = event.target.files[0];
    // 오디오 파일인지 확인
    if (file.type.startsWith("audio/")) {
      onFileSelect(file);
    }
  };
  return (
    <>
      {/* 파일 선택 버튼 */}
      <FileSelectButton onClick={handleFileSelect} disabled={isLoading}>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <g clipPath="url(#clip0_601_3669)">
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M21 6.75V21C21 21.7956 20.6839 22.5587 20.1213 23.1213C19.5587 23.6839 18.7956 24 18 24V22.5C18.3978 22.5 18.7794 22.342 19.0607 22.0607C19.342 21.7794 19.5 21.3978 19.5 21V6.75H16.5C15.9033 6.75 15.331 6.51295 14.909 6.09099C14.4871 5.66903 14.25 5.09674 14.25 4.5V1.5H6C5.60218 1.5 5.22064 1.65804 4.93934 1.93934C4.65804 2.22064 4.5 2.60218 4.5 3V16.5H3V3C3 2.20435 3.31607 1.44129 3.87868 0.87868C4.44129 0.316071 5.20435 0 6 0L14.25 0L21 6.75ZM13.6335 21.255H12.969V20.3415H13.602C13.7694 20.344 13.935 20.3065 14.085 20.232C14.22 20.1636 14.334 20.0599 14.415 19.932C14.4948 19.8046 14.5345 19.6562 14.529 19.506C14.5326 19.3944 14.5106 19.2834 14.4649 19.1815C14.4191 19.0796 14.3508 18.9895 14.265 18.918C14.0795 18.7635 13.8432 18.6833 13.602 18.693C13.4733 18.6902 13.3452 18.711 13.224 18.7545C13.1178 18.7919 13.0196 18.8489 12.9345 18.9225C12.8568 18.9872 12.7929 19.0669 12.7468 19.1568C12.7006 19.2468 12.6732 19.3451 12.666 19.446H11.565C11.574 19.211 11.625 18.9925 11.718 18.7905C11.812 18.5885 11.947 18.4125 12.123 18.2625C12.299 18.1105 12.513 17.992 12.765 17.907C13.02 17.822 13.3115 17.778 13.6395 17.775C14.0575 17.772 14.419 17.838 14.724 17.973C15.028 18.108 15.264 18.294 15.432 18.531C15.6032 18.7656 15.6942 19.0491 15.6915 19.3395C15.7055 19.5912 15.6427 19.8412 15.5115 20.0565C15.4096 20.2236 15.2747 20.3682 15.1151 20.4814C14.9554 20.5946 14.7744 20.6741 14.583 20.715V20.7765C14.799 20.8005 15.0071 20.8712 15.1931 20.9836C15.379 21.096 15.5383 21.2475 15.66 21.4275C15.8104 21.6597 15.8858 21.9325 15.876 22.209C15.879 22.494 15.8205 22.7475 15.7005 22.9695C15.5818 23.194 15.4129 23.388 15.207 23.5365C14.997 23.6885 14.754 23.8055 14.478 23.8875C14.205 23.9675 13.9135 24.0075 13.6035 24.0075C13.1525 24.0075 12.7675 23.931 12.4485 23.778C12.1541 23.6425 11.9017 23.43 11.718 23.163C11.5537 22.9111 11.4614 22.6191 11.451 22.3185H12.54C12.5517 22.4608 12.6072 22.5961 12.699 22.7055C12.8021 22.8215 12.9297 22.9132 13.0725 22.974C13.2434 23.0399 13.4249 23.074 13.608 23.0745C13.806 23.0792 14.0027 23.0403 14.184 22.9605C14.3382 22.8898 14.4692 22.7769 14.562 22.635C14.6532 22.4924 14.6992 22.3257 14.694 22.1565C14.6968 21.9912 14.6508 21.8287 14.5617 21.6894C14.4726 21.5501 14.3443 21.4402 14.193 21.3735C14.0192 21.2897 13.8278 21.2491 13.635 21.255H13.6335ZM1.059 23.8875V19.8975H1.116L2.544 23.1375H3.318L4.737 19.8975H4.794V23.8875H5.8665V17.889H4.6665L2.9565 21.783H2.9175L1.2075 17.889H0V23.889L1.059 23.8875ZM9.246 17.889H6.846V23.889H8.034V21.876H9.2385C9.6685 21.876 10.0345 21.7895 10.3365 21.6165C10.6405 21.4395 10.872 21.202 11.031 20.904C11.1957 20.5912 11.2788 20.2419 11.2725 19.8885C11.2725 19.5145 11.1935 19.176 11.0355 18.873C10.8772 18.5745 10.6381 18.3265 10.3455 18.1575C10.0105 17.9691 9.63017 17.8762 9.246 17.889ZM10.0635 19.8885C10.0688 20.0866 10.025 20.283 9.936 20.46C9.85653 20.6131 9.7326 20.7386 9.5805 20.82C9.40576 20.906 9.2127 20.9483 9.018 20.943H8.028V18.834H9.018C9.346 18.834 9.6025 18.925 9.7875 19.107C9.9715 19.288 10.0635 19.5485 10.0635 19.8885Z"
              fill="#464A4D"
            />
          </g>
          <defs>
            <clipPath id="clip0_601_3669">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
        파일을 첨부해주세요
      </FileSelectButton>

      {/* 선택된 파일 표시 */}
      {selectedFile && (
        <SelectedFileName>
          <span>{selectedFile.name}</span>
          <RemoveFileButton onClick={onRemoveFile}>×</RemoveFileButton>
        </SelectedFileName>
      )}

      <input
        ref={fileInputRef}
        type="file"
        accept="audio/*"
        capture="microphone" // 모바일에서 녹음 앱 우선 표시
        style={{ display: "none" }}
        onChange={handleFileChange}
      />
    </>
  );
};

export default FileUpload;